{% extends "base.html" %}

{% block title %}System Report{% endblock %}

{% block navbar %}{% endblock navbar %}
{% block styles %}
<style>
    body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        color: #333;
        margin: 40px;
    }

    h2,
    h3 {
        color: #2c3e50;
        margin-bottom: 20px;
    }

    h2 {
        border-bottom: 2px solid #3498db;
        padding-bottom: 10px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    th {
        background: #3498db;
        color: white;
        padding: 12px;
        text-align: left;
    }

    td {
        padding: 12px;
        border: 1px solid #ddd;
    }

    tr:nth-child(even) {
        background: #f8f9fa;
    }

    img {
        max-width: 100%;
        height: auto;
        margin: 20px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .report-date {
        color: #666;
        font-size: 0.9em;
        margin-bottom: 30px;
    }

    .no-data {
        color: #666;
        font-style: italic;
        padding: 20px;
        text-align: center;
        background: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .footer {
        margin-top: 40px;
        padding-top: 20px;
        border-top: 1px solid #ddd;
        text-align: center;
        color: #666;
        font-size: 12px;
    }
</style>
{% endblock styles %}

{% block content %}
<div class="report-date">
    <h2>System Report - {{ current_date.strftime("%B %d, %Y") }}</h2>
</div>

{% if base64_image %}
<div class="chart-section">
    <img src="{{ base64_image }}" alt="Participation Chart">
</div>
{% endif %}

<section class="participation-section">
    <h3>Event Participation</h3>
    {% if participation_data %}
    <table>
        <thead>
            <tr>
                <th>Event</th>
                <th>Confirmed Participants</th>
            </tr>
        </thead>
        <tbody>
            {% for event_title, count in participation_data %}
            <tr>
                <td>{{ event_title }}</td>
                <td>{{ count }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="no-data">No participation data available.</div>
    {% endif %}
</section>

<section class="feedback-section">
    <h3>Event Feedback (Average Rating)</h3>
    {% if feedback_data %}
    <table>
        <thead>
            <tr>
                <th>Event</th>
                <th>Average Rating</th>
            </tr>
        </thead>
        <tbody>
            {% for event_title, avg_rating in feedback_data %}
            <tr>
                <td>{{ event_title }}</td>
                <td>{{ "%.2f"|format(avg_rating if avg_rating else 0) }}/5.00</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="no-data">No feedback data available.</div>
    {% endif %}
</section>

<section class="stats-section">
    <h3>Event Statistics</h3>
    <table>
        <thead>
            <tr>
                <th>Metric</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Total Events:</td>
                <td>{{ event_stats.total_events }}</td>
            </tr>
            <tr>
                <td>Average Attendance:</td>
                <td>{{ "%.2f"|format(event_stats.average_attendance) }}</td>
            </tr>
        </tbody>
    </table>

    <h4>Category Distribution</h4>
    <table>
        <thead>
            <tr>
                <th>Category</th>
                <th>Count</th>
            </tr>
        </thead>
        <tbody>
            {% for category, count in event_stats.event_by_category %}
            <tr>
                <td>{{ category }}</td>
                <td>{{ count }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>

<section class="user-section">
    <h3>User Statistics</h3>
    <!-- Add user stats tables -->
</section>

<section class="club-section">
    <h3>Club Statistics</h3>
    <!-- Add club stats tables -->
</section>
{% endblock content %}

{% block footer %}
<div class="footer">
    <p>Generated by DETYS System - {{ current_date.strftime("%Y-%m-%d %H:%M:%S") }}</p>
</div>
{% endblock %}