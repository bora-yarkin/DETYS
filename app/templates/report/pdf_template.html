{% extends "base.html" %}

{% block title %}System Report{% endblock %}

{% block navbar %}{% endblock navbar %}
{% block styles %}
{{ super() }}
<!-- Removed inline custom styles to use standard site styling -->
{% endblock styles %}

{% block content %}
<div class="container my-5">
    <h2>System Report - {{ current_date.strftime("%B %d, %Y") }}</h2>

    {% if base64_image %}
    <div class="text-center my-4">
        <img src="{{ base64_image }}" alt="Participation Chart" class="img-fluid rounded">
    </div>
    {% endif %}

    {% if base64_rating_chart %}
    <div class="text-center my-4">
        <h4>Rating Distribution</h4>
        <img src="{{ base64_rating_chart }}" alt="Rating Distribution" class="img-fluid rounded">
    </div>
    {% endif %}

    {% if base64_category_chart %}
    <div class="text-center my-4">
        <h4>Category Distribution</h4>
        <img src="{{ base64_category_chart }}" alt="Category Distribution" class="img-fluid rounded">
    </div>
    {% endif %}

    {% if base64_club_chart %}
    <div class="text-center my-4">
        <h4>Most Active Clubs</h4>
        <img src="{{ base64_club_chart }}" alt="Club Activity" class="img-fluid rounded">
    </div>
    {% endif %}

    <section class="my-4">
        <h3>Event Participation</h3>
        {% if participation_data %}
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Event</th>
                    <th>Confirmed Participants</th>
                </tr>
            </thead>
            <tbody>
                {% for event_title, count in participation_data %}
                <tr>
                    <td>{{ event_title }}</td>
                    <td>{{ count }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="alert alert-secondary text-center">No participation data available.</div>
        {% endif %}
    </section>

    <section class="mb-4">
        <h3>Event Feedback (Average Rating)</h3>
        {% if feedback_data %}
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Event</th>
                    <th>Average Rating</th>
                </tr>
            </thead>
            <tbody>
                {% for title, avg_rating in feedback_data %}
                <tr>
                    <td>{{ title }}</td>
                    <td>{{ "%.2f"|format(avg_rating if avg_rating else 0) }}/5.00</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="alert alert-secondary text-center">No feedback data available.</div>
        {% endif %}
    </section>

    <section class="mb-4">
        <h3>Event Statistics</h3>
        <table class="table table-bordered">
            <tbody>
                <tr>
                    <td>Total Events:</td>
                    <td>{{ event_stats.total_events }}</td>
                </tr>
                <tr>
                    <td>Average Attendance:</td>
                    <td>{{ "%.2f"|format(event_stats.average_attendance) }}</td>
                </tr>
            </tbody>
        </table>

        <h4>Category Distribution</h4>
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Count</th>
                </tr>
            </thead>
            <tbody>
                {% for category, count in event_stats.event_by_category %}
                <tr>
                    <td>{{ category }}</td>
                    <td>{{ count }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <section class="mb-4">
        <h3>User Statistics</h3>
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Total Users</td>
                    <td>{{ user_stats.total_users }}</td>
                </tr>
                <tr>
                    <td>Active Users (30 days)</td>
                    <td>{{ user_stats.active_users }}</td>
                </tr>
                <tr>
                    <td>New Users (30 days)</td>
                    <td>{{ user_stats.new_users }}</td>
                </tr>
                <tr>
                    <td>Avg Events/User</td>
                    <td>{{ "%.2f"|format(user_stats.average_events_per_user) }}</td>
                </tr>
            </tbody>
        </table>
    </section>

    <section class="mb-4">
        <h3>Club Statistics</h3>
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Total Clubs</td>
                    <td>{{ club_stats.total_clubs }}</td>
                </tr>
                <tr>
                    <td>Average Members</td>
                    <td>{{ "%.2f"|format(club_stats.avg_members) }}</td>
                </tr>
                {% for club, count in club_stats.most_active_clubs %}
                <tr>
                    <td>Most Active: {{ club }}</td>
                    <td>{{ count }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <section class="mb-5">
        <h3>Feedback Analysis</h3>
        <p>Average Rating: {{ "%.2f"|format(feedback_stats.avg_rating) }}/5.00</p>
    </section>
</div>
{% endblock content %}

{% block footer %}
<div class="text-center text-muted py-3">
    <small>Generated by DETYS System - {{ current_date.strftime("%Y-%m-%d %H:%M:%S") }}</small>
</div>
{% endblock %}