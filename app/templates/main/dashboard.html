{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}
{% block content %}

<h2>Welcome, {{ user.username }}!</h2>
<p>Your role: {{ user.role }}</p>

{% if dashboard_mode == 'admin' %}
<h3>Administrator Dashboard</h3>
<p>Welcome, {{ user.username }}. Manage the system here.</p>
<div class="admin-stats">
    
    <h3>System Statistics</h3>
    <ul>
        <li><strong>Total Users:</strong> {{ total_users }}</li>
        <li><strong>Total Clubs:</strong> {{ total_clubs }}</li>
        <li><strong>Total Events:</strong> {{ total_events }}</li>
    </ul>

    <h3>Top 5 Events by Participation</h3>
    {% if top_events %}
    <ol>
        {% for title, count in top_events %}
        <li>{{ title }} - {{ count }} attendees</li>
        {% endfor %}
    </ol>
    {% else %}
    <p>No events found.</p>
    {% endif %}
    <h3>Additional Stats</h3>
    <p>Resources Uploaded: {{ resource_count }}</p>
    <p>Polls Created: {{ poll_count }}</p>
        <div class="new-post-section">
            <a href="{{ url_for('post.create_post') }}" class="btn btn-primary">Create New Post</a>
        </div>
    <p>
        <a href="{{ url_for('report.reports') }}" class="btn btn-info">Full Reports</a>
    </p>
    <a href="{{ url_for('category.list_categories') }}" class="btn btn-info">Manage Categories</a>
</div>

{% elif dashboard_mode == 'manager' %}
<div class="manager-stats">
    <h3>My Clubs</h3>
    {% if clubs_managed %}
    <ul>
        {% for club in clubs_managed %}
        <li>{{ club.name }} ({{ club.members|length }} members)</li>
        {% endfor %}
    </ul>
    {% else %}
    <p>You are not managing any club right now.</p>
    {% endif %}

    <p><strong>Pending Membership Requests:</strong> {{ pending_membership_requests }}</p>

    <h3>Upcoming Events</h3>
    {% if upcoming_events %}
    <ul>
        {% for event in upcoming_events %}
        <li>{{ event.title }} on {{ event.date.strftime('%Y-%m-%d %H:%M') }}</li>
        {% endfor %}
    </ul>
    {% else %}
    <p>No upcoming events for your clubs.</p>
    {% endif %}

    <h3>Top Events by Attendance</h3>
    {% if manager_top_events %}
    <ol>
        {% for title, count in manager_top_events %}
        <li>{{ title }} - {{ count }} attendees</li>
        {% endfor %}
    </ol>
    {% else %}
    <p>No significant attendance data available for your clubs.</p>
    {% endif %}
    <h3>Additional Stats</h3>
    <p>Resources Uploaded: {{ resource_count }}</p>
    <p>Polls Created In My Clubs: {{ poll_count }}</p>

    <div class="new-post-section">
        <a href="{{ url_for('post.create_post') }}" class="btn btn-primary">Create New Post</a>
    </div>

    <p>
        <a href="{{ url_for('report.reports') }}" class="btn btn-info">View My Club Reports</a>
    </p>
</div>

{% else %}
<div class="student-panel">
    <h3>My Upcoming Events</h3>
    {% if user_events %}
    <ul>
        {% for attendance in user_events %}
        <li>
            {{ attendance.event.title }} on
            {{ attendance.event.date.strftime('%Y-%m-%d %H:%M') }}
            (Status: {{ attendance.status }})
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p>You haven't registered for any events yet.</p>
    {% endif %}

    <h3>My Clubs</h3>
    {% if joined_clubs %}
    <ul>
        {% for membership in joined_clubs %}
        <li>{{ membership.club.name }}</li>
        {% endfor %}
    </ul>
    {% else %}
    <p>You are not a member of any clubs, or your membership is pending.</p>
    {% endif %}
    <h3>My Bookmarked Events</h3>
    {% if bookmark_events %}
    <ul>
        {% for ev in bookmark_events %}
        <li><a href="{{ url_for('event.event_detail', event_id=ev.id) }}">{{ ev.title }}</a></li>
        {% endfor %}
    </ul>
    {% else %}
    <p>You haven't bookmarked any events.</p>
    {% endif %}
    
    <h3>My Bookmarked Clubs</h3>
    {% if bookmark_clubs %}
    <ul>
        {% for cb in bookmark_clubs %}
        <li><a href="{{ url_for('club.club_detail', club_id=cb.id) }}">{{ cb.name }}</a></li>
        {% endfor %}
    </ul>
    {% else %}
    <p>You haven't bookmarked any clubs.</p>
    {% endif %}
</div>
{% endif %}

{% endblock %}