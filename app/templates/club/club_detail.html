{% extends 'base.html' %}

{% block title %}{{ club.name }}{% endblock %}

{% block content %}
<h2>{{ club.name }}</h2>
<p>{{ club.description }}</p>
<p>Contact Email: {{ club.contact_email }}</p>

{% if current_user.is_authenticated %}
    {% set club_bookmarked = current_user.bookmarks|selectattr("club_id", "equalto", club.id)|list %}
    {% if club_bookmarked %}
        <a href="{{ url_for('bookmark.remove_club_bookmark', club_id=club.id) }}" class="btn btn-sm btn-warning">Remove Bookmark</a>
    {% else %}
        <a href="{{ url_for('bookmark.add_club_bookmark', club_id=club.id) }}" class="btn btn-sm btn-info">Bookmark This Club</a>
    {% endif %}

    {% if is_member %}
        {% if membership.is_approved %}
            <p>You are a member of this club.</p>
        {% else %}
            <p>Your membership request is pending approval.</p>
        {% endif %}
    {% else %}
        <a href="{{ url_for('club.join_club', club_id=club.id) }}" class="btn btn-primary">Join Club</a>
    {% endif %}
{% endif %}

{% if club.president_id == current_user.id %}
    <a href="{{ url_for('club.manage_members', club_id=club.id) }}" class="btn btn-secondary">Manage Members</a>
    <a href="{{ url_for('club.edit_club', club_id=club.id) }}" class="btn btn-warning">Edit Club</a>
    <form action="{{ url_for('club.delete_club', club_id=club.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this club?');" style="display:inline;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button type="submit" class="btn btn-danger">Delete Club</button>
    </form>
{% endif %}

<h3>Upcoming Events</h3>
<ul>
    {% for event in club.events %}
        <li>
            <a href="{{ url_for('event.event_detail', event_id=event.id) }}">{{ event.title }}</a> on {{ event.date.strftime('%Y-%m-%d %H:%M') }}
        </li>
    {% endfor %}
</ul>
{% endblock %}